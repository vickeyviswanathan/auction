<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cricket Auction App</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f3f4f6; overflow: hidden; }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        
        /* Custom Scrollbar for inner containers */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // --- Icon Component ---
        const Icon = ({ name, size = 24, className = "", ...props }) => {
            const icons = {
                Upload: <><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" y1="3" x2="12" y2="15" /></>,
                Download: <><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" y1="15" x2="12" y2="3" /></>,
                Gavel: <><path d="m14 13-7.5 7.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L11 10" /><path d="m16 16 6-6" /><path d="m8 8 6-6" /><path d="m9 7 8 8" /><path d="m21 11-8-8" /></>,
                User: <><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></>,
                Users: <><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M22 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></>,
                DollarSign: <><line x1="12" y1="1" x2="12" y2="23" /><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" /></>,
                Trophy: <><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" /><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" /><path d="M4 22h16" /><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" /><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" /><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" /></>,
                AlertCircle: <><circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="12" /><line x1="12" y1="16" x2="12.01" y2="16" /></>,
                RefreshCw: <><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" /><path d="M21 3v5h-5" /><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" /><path d="M3 21v-5h5" /></>,
                Play: <><polygon points="5 3 19 12 5 21 5 3" /></>,
                Pause: <><rect x="6" y="4" width="4" height="16" /><rect x="14" y="4" width="4" height="16" /></>,
                SkipForward: <><polygon points="5 4 15 12 5 20 5 4" /><line x1="19" y1="5" x2="19" y2="19" /></>,
                CheckCircle: <><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></>,
                TrendingUp: <><polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" /></>,
                Edit2: <><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" /></>,
                Save: <><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" /><polyline points="17 21 17 13 7 13 7 21" /><polyline points="7 3 7 8 15 8" /></>,
                Trash2: <><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" y1="11" x2="10" y2="17" /><line x1="14" y1="11" x2="14" y2="17" /></>,
                Eye: <><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" /><circle cx="12" cy="12" r="3" /></>,
                List: <><line x1="8" y1="6" x2="21" y2="6" /><line x1="8" y1="12" x2="21" y2="12" /><line x1="8" y1="18" x2="21" y2="18" /><line x1="3" y1="6" x2="3.01" y2="6" /><line x1="3" y1="12" x2="3.01" y2="12" /><line x1="3" y1="18" x2="3.01" y2="18" /></>
            };

            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                    {icons[name] || null}
                </svg>
            );
        };

        // --- Default Data ---
        const DEMO_PLAYERS = [
          { id: 1, name: "Siddharth Chainani", email: "siddharth.chainani@workstore.in", frequency: "Sometimes Monthly", strength: "All Rounder", gender: "Male", status: "unsold" },
          { id: 2, name: "Siddhant", email: "siddhant.pardhe@holistique.in", frequency: "Sometimes Monthly", strength: "All Rounder", gender: "Male", status: "unsold" },
          { id: 3, name: "Rakesh Daima", email: "Rakesh.Daima@workstore.in", frequency: "Sometimes Monthly", strength: "All Rounder", gender: "Male", status: "unsold" },
          { id: 4, name: "Abhishek Raul", email: "Abhishek.raul@workstore.in", frequency: "Rarely", strength: "Batsman", gender: "Male", status: "unsold" },
          { id: 33, name: "Shivakshi Mishra", email: "shivakshi.mishra@glidebrands.in", frequency: "Rarely", strength: "All Rounder", gender: "Female", status: "unsold" },
          { id: 34, name: "Pushti", email: "pushti.seth@glidebrands.in", frequency: "Rarely", strength: "Just wanna enjoy", gender: "Female", status: "unsold" },
          { id: 35, name: "Balram Roy", email: "balram.roy@workstore.in", frequency: "Once a week", strength: "All Rounder", gender: "Male", status: "unsold" },
          { id: 36, name: "Aniket Gaikwad", email: "aniket.gaikwad@workstore.in", frequency: "Rarely", strength: "Just wanna enjoy", gender: "Male", status: "unsold" },
          { id: 38, name: "Naresh", email: "naresh@holistique.in", frequency: "Rarely", strength: "Batsman", gender: "Male", status: "unsold" }
        ];

        // --- Constants ---
        const TOTAL_BUDGET = 100000;
        const MIN_SQUAD_SIZE = 10;
        const MIN_FEMALE_COUNT = 3;
        const BASE_PRICE = 1000;
        const STORAGE_KEY = 'cricket_auction_v1';

        // --- Components ---
        const Card = ({ children, className = "" }) => (
          <div className={`bg-white rounded-xl shadow border border-gray-100 overflow-hidden ${className}`}>
            {children}
          </div>
        );

        const Badge = ({ children, type = "neutral" }) => {
          const styles = {
            neutral: "bg-gray-100 text-gray-700",
            male: "bg-blue-100 text-blue-800",
            female: "bg-pink-100 text-pink-800",
            success: "bg-green-100 text-green-800",
            warning: "bg-yellow-100 text-yellow-800",
            danger: "bg-red-100 text-red-800",
            info: "bg-indigo-100 text-indigo-800",
          };
          return <span className={`px-2 py-0.5 rounded-md text-[10px] font-bold uppercase ${styles[type]}`}>{children}</span>;
        };

        // --- Main App ---
        const AuctionApp = () => {
          
          const loadState = (key, fallback) => {
            try {
              const saved = localStorage.getItem(STORAGE_KEY);
              if (saved) {
                const parsed = JSON.parse(saved);
                return parsed[key] || fallback;
              }
            } catch (e) {
              console.error("Failed to load from storage", e);
            }
            return fallback;
          };

          const [players, setPlayers] = useState(() => loadState('players', DEMO_PLAYERS));
          
          const initialTeams = {
            'team1': { id: 'team1', name: 'Team A', budget: TOTAL_BUDGET, roster: [], females: 0 },
            'team2': { id: 'team2', name: 'Team B', budget: TOTAL_BUDGET, roster: [], females: 0 },
            'team3': { id: 'team3', name: 'Team C', budget: TOTAL_BUDGET, roster: [], females: 0 },
            'team4': { id: 'team4', name: 'Team D', budget: TOTAL_BUDGET, roster: [], females: 0 },
          };

          const [teams, setTeams] = useState(() => loadState('teams', initialTeams));
          const [history, setHistory] = useState(() => loadState('history', []));
          const [currentPlayer, setCurrentPlayer] = useState(() => loadState('currentPlayer', null));
          const [currentBid, setCurrentBid] = useState(BASE_PRICE);
          const [currentBidder, setCurrentBidder] = useState(null); 
          const [view, setView] = useState('auction'); 
          
          const [timeLeft, setTimeLeft] = useState(60);
          const [isTimerRunning, setIsTimerRunning] = useState(false);
          const [auctionFinished, setAuctionFinished] = useState(false);
          const [editingTeam, setEditingTeam] = useState(null); 

          useEffect(() => {
            const dataToSave = { players, teams, history, currentPlayer };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
          }, [players, teams, history, currentPlayer]);

          useEffect(() => {
            if (!currentPlayer && !auctionFinished && players.filter(p => p.status === 'unsold').length > 0) {
              const savedData = localStorage.getItem(STORAGE_KEY);
              if (!savedData) loadNextPlayer();
            }
          }, []);

          useEffect(() => {
            let interval = null;
            if (isTimerRunning && timeLeft > 0) {
              interval = setInterval(() => setTimeLeft((prev) => prev - 1), 1000);
            } else if (timeLeft === 0) {
              setIsTimerRunning(false);
            }
            return () => clearInterval(interval);
          }, [isTimerRunning, timeLeft]);

          useEffect(() => {
            const handleKeyPress = (e) => {
              if (e.target.tagName === 'INPUT') return;
              if (e.code === 'Space') {
                e.preventDefault();
                setIsTimerRunning(prev => !prev);
              } else if (e.key.toLowerCase() === 's' && currentBidder) {
                handleSell();
              } else if (e.key.toLowerCase() === 'p') {
                handleUnsold();
              }
            };
            window.addEventListener('keydown', handleKeyPress);
            return () => window.removeEventListener('keydown', handleKeyPress);
          }, [currentBidder, currentPlayer]);

          const handleResetData = () => {
            if (window.confirm("WARNING: You are about to delete ALL auction data.")) {
              if (window.confirm("DOUBLE CHECK: Are you really sure?")) {
                localStorage.removeItem(STORAGE_KEY);
                window.location.reload();
              }
            }
          };

          const loadNextPlayer = (playerList = players) => {
            const unsold = playerList.filter(p => p.status === 'unsold');
            if (unsold.length > 0) {
              const randomIndex = Math.floor(Math.random() * unsold.length);
              setCurrentPlayer(unsold[randomIndex]);
              setCurrentBid(BASE_PRICE);
              setCurrentBidder(null);
              setTimeLeft(60);
              setIsTimerRunning(false);
              setAuctionFinished(false);
            } else {
              setCurrentPlayer(null);
              setAuctionFinished(true);
            }
          };

          const handleBid = (teamId, amount) => {
            if (teams[teamId].budget < amount) {
              alert(`${teams[teamId].name} does not have enough budget!`);
              return;
            }
            setCurrentBid(amount);
            setCurrentBidder(teamId);
            
            // Logic: Reset to 30s and KEEP RUNNING for rapid fire
            setTimeLeft(30); 
            setIsTimerRunning(true); 
            
            setHistory(prev => [{ msg: `${teams[teamId].name} bid ‚Çπ${amount.toLocaleString()}`, type: 'bid' }, ...prev].slice(0, 10)); // Keep more history
          };

          const handleSell = () => {
            if (!currentBidder) {
              handleUnsold();
              return;
            }
            const updatedTeams = { ...teams };
            const team = updatedTeams[currentBidder];
            team.budget -= currentBid;
            team.roster.push({ ...currentPlayer, soldPrice: currentBid });
            if (currentPlayer.gender === 'Female') team.females += 1;
            setTeams(updatedTeams);
            const updatedPlayers = players.map(p => 
              p.id === currentPlayer.id ? { ...p, status: 'sold', soldTo: currentBidder, soldPrice: currentBid } : p
            );
            setPlayers(updatedPlayers);
            setHistory(prev => [{ msg: `${currentPlayer.name} SOLD to ${teams[currentBidder].name} for ‚Çπ${currentBid.toLocaleString()}`, type: 'sale' }, ...prev]);
            loadNextPlayer(updatedPlayers);
          };

          const handleUnsold = () => {
            const updatedPlayers = players.map(p => p.id === currentPlayer.id ? { ...p, status: 'passed' } : p);
            setPlayers(updatedPlayers);
            setHistory(prev => [{ msg: `${currentPlayer.name} went UNSOLD`, type: 'info' }, ...prev]);
            loadNextPlayer(updatedPlayers);
          };

          const restartUnsold = () => {
            const updatedPlayers = players.map(p => p.status === 'passed' ? { ...p, status: 'unsold' } : p);
            setPlayers(updatedPlayers);
            setAuctionFinished(false);
            loadNextPlayer(updatedPlayers);
            setView('auction');
          };

          const auctionSpecificPlayer = (player) => {
            const updatedPlayers = players.map(p => p.id === player.id ? { ...p, status: 'unsold' } : p);
            setPlayers(updatedPlayers);
            setCurrentPlayer({ ...player, status: 'unsold' });
            setCurrentBid(BASE_PRICE);
            setCurrentBidder(null);
            setTimeLeft(60);
            setIsTimerRunning(false);
            setAuctionFinished(false);
            setView('auction');
          };

          const updateTeamName = (teamId, newName) => {
            setTeams(prev => ({ ...prev, [teamId]: { ...prev[teamId], name: newName } }));
          };

          const handleFileUpload = (event) => {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
              const text = e.target.result;
              const rows = text.split('\n').slice(1);
              const newPlayers = rows.map((row, index) => {
                const cols = row.split(',');
                if (cols.length < 5) return null;
                return {
                  id: index + 100, 
                  name: cols[4] || "Unknown",
                  email: cols[3] || "",
                  frequency: cols[7] || "Unknown",
                  strength: cols[8] || "Unknown",
                  gender: (cols[9] || "").trim(),
                  status: 'unsold'
                };
              }).filter(p => p && p.name);
              setPlayers(newPlayers);
              setView('auction');
              loadNextPlayer(newPlayers);
            };
            reader.readAsText(file);
          };

          const handleExport = () => {
            const headers = ['ID', 'Name', 'Email', 'Gender', 'Strength', 'Status', 'Team', 'Price'];
            const csvRows = [headers.join(',')];
            players.forEach(player => {
              const teamName = player.soldTo ? teams[player.soldTo]?.name : 'Unsold';
              const row = [player.id, `"${player.name}"`, player.email, player.gender, `"${player.strength}"`, player.status, teamName, player.soldPrice || 0];
              csvRows.push(row.join(','));
            });
            const blob = new Blob([csvRows.join('\n')], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'cricket_auction_results.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
          };

          const getTeamColor = (teamId) => {
            const index = Object.keys(teams).indexOf(teamId);
            const colors = ['border-red-500 bg-red-50 text-red-900', 'border-blue-500 bg-blue-50 text-blue-900', 'border-yellow-500 bg-yellow-50 text-yellow-900', 'border-purple-500 bg-purple-50 text-purple-900'];
            return colors[index % colors.length] || 'border-gray-200';
          };

          const getStrengthIcon = (strength) => {
            if (!strength) return <Icon name="User" size={20} />;
            const s = strength.toLowerCase();
            if (s.includes('bat')) return <span className="text-xl">üèè</span>;
            if (s.includes('bowl')) return <span className="text-xl">ü•é</span>;
            if (s.includes('all')) return <span className="text-xl">üåü</span>;
            return <span className="text-xl">üôÇ</span>;
          };

          const getStatusBadge = (player) => {
            if (player.status === 'sold') return <Badge type="success">SOLD</Badge>;
            if (player.status === 'passed') return <Badge type="danger">UNSOLD</Badge>;
            return <Badge type="neutral">WAITING</Badge>;
          };

          // --- VIEWS ---

          const AuctionView = () => (
            <div className="h-full flex flex-col lg:flex-row gap-4 overflow-hidden p-2">
              
              {/* Left Col: Player Profile (25%) */}
              <div className="lg:w-1/4 flex flex-col gap-4 h-full">
                {currentPlayer ? (
                  <Card className="flex-1 flex flex-col p-4 bg-white border-t-8 border-indigo-600">
                    <div className="flex-1 flex flex-col items-center justify-center text-center space-y-3">
                      <div className={`w-32 h-32 rounded-full flex items-center justify-center text-6xl shadow-inner ${currentPlayer.gender === 'Female' ? 'bg-pink-100 text-pink-500' : 'bg-blue-100 text-blue-500'}`}>
                        {currentPlayer.gender === 'Female' ? 'üë©' : 'üë®'}
                      </div>
                      <div>
                        <h2 className="text-2xl font-black text-gray-800 leading-tight">{currentPlayer.name}</h2>
                        <div className="flex flex-wrap justify-center gap-2 mt-2">
                          <Badge type={currentPlayer.gender === 'Female' ? 'female' : 'male'}>{currentPlayer.gender}</Badge>
                          <span className="text-xs font-medium px-2 py-0.5 bg-gray-100 rounded text-gray-600 flex items-center gap-1">
                            {getStrengthIcon(currentPlayer.strength)} {currentPlayer.strength}
                          </span>
                        </div>
                      </div>
                      <div className="text-xs text-gray-500 mt-2 bg-gray-50 p-2 rounded w-full">
                        <p>Freq: {currentPlayer.frequency}</p>
                        <p className="truncate">{currentPlayer.email}</p>
                      </div>
                    </div>
                  </Card>
                ) : (
                  <Card className="flex-1 flex items-center justify-center p-4">
                     {auctionFinished ? 
                        <div className="text-center">
                            <Icon name="Trophy" size={48} className="text-yellow-500 mx-auto mb-2"/>
                            <h3 className="font-bold">Finished</h3>
                            <button onClick={restartUnsold} className="mt-2 text-xs bg-blue-100 text-blue-700 px-3 py-1 rounded">Reset Unsold</button>
                        </div> : 
                        <p className="text-gray-400">Loading...</p>
                     }
                  </Card>
                )}
              </div>

              {/* Center Col: Arena (50%) */}
              <div className="lg:w-1/2 flex flex-col gap-4 h-full">
                {/* Top: Timer & Bid */}
                <Card className="p-4 flex flex-col items-center justify-center bg-indigo-50 border-indigo-100 relative">
                   <div className="w-full flex justify-between items-start mb-2">
                      <div className="text-left">
                        <span className="text-xs font-bold text-gray-400 uppercase tracking-widest">Timer</span>
                        <div className={`text-4xl font-mono font-bold ${timeLeft < 10 ? 'text-red-500 animate-pulse' : 'text-gray-700'}`}>
                           {timeLeft}s
                        </div>
                      </div>
                      <div className="text-right">
                        <span className="text-xs font-bold text-gray-400 uppercase tracking-widest">Current Bid</span>
                        <div className="flex items-center justify-end">
                            <span className="text-2xl text-indigo-400 mr-1">‚Çπ</span>
                            <input 
                              type="number" 
                              value={currentBid} 
                              onChange={(e) => setCurrentBid(parseInt(e.target.value) || 0)}
                              className="text-4xl font-bold text-indigo-700 bg-transparent w-40 text-right focus:outline-none border-b border-indigo-200 focus:border-indigo-500"
                            />
                        </div>
                        {currentBidder && <div className="text-xs font-bold text-green-600">Held by {teams[currentBidder].name}</div>}
                      </div>
                   </div>
                   
                   {/* Progress Bar */}
                   <div className="w-full bg-gray-200 rounded-full h-2 mb-4 overflow-hidden">
                      <div className={`h-full transition-all duration-1000 ease-linear ${timeLeft < 10 ? 'bg-red-500' : 'bg-indigo-500'}`} style={{ width: `${(timeLeft / 60) * 100}%` }}></div>
                   </div>

                   {/* Controls */}
                   <div className="flex gap-4 w-full">
                      <button onClick={() => setIsTimerRunning(!isTimerRunning)} className="flex-1 py-3 bg-gray-800 hover:bg-gray-900 text-white rounded-lg font-bold flex items-center justify-center gap-2 shadow-lg transition-transform active:scale-95">
                         {isTimerRunning ? <Icon name="Pause"/> : <Icon name="Play"/>} {isTimerRunning ? "PAUSE" : "START"}
                      </button>
                      <button onClick={handleSell} className="flex-1 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-bold flex items-center justify-center gap-2 shadow-lg transition-transform active:scale-95">
                         <Icon name="Gavel"/> SOLD
                      </button>
                      <button onClick={handleUnsold} className="px-4 py-3 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg font-bold flex items-center justify-center transition-colors">
                         PASS
                      </button>
                   </div>
                </Card>

                {/* Bottom: Bidding Grid */}
                <div className="flex-1 grid grid-cols-2 grid-rows-2 gap-3 min-h-0">
                  {Object.values(teams).map(team => {
                    const isAffordable = team.budget >= (currentBid + 500);
                    const isWinning = currentBidder === team.id;
                    const isDisabled = !isAffordable || isWinning || !currentPlayer;
                    
                    return (
                      <button
                        key={team.id}
                        disabled={isDisabled}
                        onClick={() => handleBid(team.id, currentBid + (currentBidder ? 500 : 0))}
                        className={`
                          relative rounded-xl border-2 p-4 flex flex-col items-center justify-center transition-all duration-200 active:scale-95
                          ${isWinning ? 'border-green-500 bg-green-50 ring-2 ring-green-200' : 'border-gray-200 bg-white hover:border-indigo-400 hover:shadow-md'}
                          ${isDisabled ? 'opacity-50 cursor-not-allowed grayscale' : ''}
                        `}
                      >
                        <h3 className="font-bold text-lg md:text-xl text-gray-800 mb-1">{team.name}</h3>
                        <span className="text-xs font-mono bg-gray-100 px-2 py-0.5 rounded text-gray-600 mb-2">‚Çπ{team.budget.toLocaleString()}</span>
                        
                        {!isDisabled && (
                           <div className="flex gap-2">
                             <div onClick={(e) => {e.stopPropagation(); handleBid(team.id, currentBid + 500)}} className="px-2 py-1 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 text-xs font-bold rounded">+500</div>
                             <div onClick={(e) => {e.stopPropagation(); handleBid(team.id, currentBid + 1000)}} className="px-2 py-1 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 text-xs font-bold rounded">+1k</div>
                             <div onClick={(e) => {e.stopPropagation(); handleBid(team.id, currentBid + 2000)}} className="px-2 py-1 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 text-xs font-bold rounded">+2k</div>
                           </div>
                        )}
                        {isWinning && <div className="absolute top-2 right-2 text-green-500"><Icon name="CheckCircle" size={20}/></div>}
                      </button>
                    )
                  })}
                </div>
              </div>

              {/* Right Col: Stats & Feed (25%) */}
              <div className="lg:w-1/4 flex flex-col gap-4 h-full">
                {/* Team Standings */}
                <Card className="flex-1 min-h-0 flex flex-col bg-white overflow-hidden">
                   <div className="p-3 bg-gray-50 border-b border-gray-100 flex justify-between items-center">
                     <h3 className="font-bold text-sm text-gray-700 uppercase">Team Standings</h3>
                   </div>
                   <div className="flex-1 overflow-y-auto p-2 space-y-2">
                     {Object.values(teams).map(t => {
                       const fNeeded = Math.max(0, MIN_FEMALE_COUNT - t.females);
                       return (
                         <div key={t.id} className={`p-2 rounded border-l-4 ${getTeamColor(t.id)} bg-gray-50 text-xs`}>
                           <div className="flex justify-between font-bold text-gray-800 mb-1">
                             <span>{t.name}</span>
                             <span>‚Çπ{t.budget.toLocaleString()}</span>
                           </div>
                           <div className="flex justify-between text-gray-500">
                             <span>Squad: {t.roster.length}/10</span>
                             <span className={fNeeded > 0 ? 'text-red-500 font-bold' : 'text-green-600'}>
                               Females: {t.females}/3
                             </span>
                           </div>
                         </div>
                       )
                     })}
                   </div>
                </Card>

                {/* Live Feed */}
                <Card className="h-1/3 flex flex-col bg-gray-900 text-gray-300">
                   <div className="p-2 border-b border-gray-700 text-xs font-bold uppercase tracking-wider text-gray-500">Live Feed</div>
                   <div className="flex-1 overflow-y-auto p-2 space-y-1.5 font-mono text-xs">
                     {history.map((h, i) => (
                       <div key={i} className={`flex items-start gap-2 ${h.type === 'sale' ? 'text-green-400' : 'text-gray-400'}`}>
                         <span className="opacity-50">{i+1}.</span>
                         <span>{h.msg}</span>
                       </div>
                     ))}
                   </div>
                </Card>
              </div>

            </div>
          );

          const TeamsView = () => (
            <div className="h-full overflow-y-auto p-4 grid grid-cols-1 md:grid-cols-2 gap-6">
              {Object.values(teams).map(team => (
                <Card key={team.id} className="p-4 h-fit">
                  <div className="flex justify-between items-center mb-4 border-b pb-2">
                     <div className="flex items-center gap-2">
                       {editingTeam === team.id ? (
                           <>
                               <input 
                                   type="text" 
                                   value={team.name}
                                   onChange={(e) => updateTeamName(team.id, e.target.value)}
                                   className="border border-indigo-300 rounded px-2 py-1 text-lg font-bold w-40"
                                   autoFocus
                               />
                               <button onClick={() => setEditingTeam(null)} className="text-green-600 hover:text-green-800"><Icon name="Save" size={18}/></button>
                           </>
                       ) : (
                           <>
                               <h2 className="text-xl font-bold">{team.name}</h2>
                               <button onClick={() => setEditingTeam(team.id)} className="text-gray-400 hover:text-indigo-600"><Icon name="Edit2" size={16}/></button>
                           </>
                       )}
                     </div>
                     <div className="font-mono font-bold text-green-600">‚Çπ{team.budget.toLocaleString()}</div>
                  </div>
                  <div className="space-y-2 max-h-60 overflow-y-auto pr-1">
                    {team.roster.map(p => (
                      <div key={p.id} className="flex justify-between text-xs bg-gray-50 p-2 rounded">
                        <span>{p.name}</span>
                        <span className="font-bold">‚Çπ{p.soldPrice}</span>
                      </div>
                    ))}
                    {team.roster.length===0 && <p className="text-gray-400 text-xs">Empty</p>}
                  </div>
                </Card>
              ))}
            </div>
          );
          
          const UnsoldView = () => (
             <div className="h-full overflow-y-auto p-4">
               <Card className="p-6">
                 <div className="flex justify-between mb-4">
                   <h2 className="text-xl font-bold">Unsold ({players.filter(p=>p.status==='passed').length})</h2>
                   <button onClick={restartUnsold} className="px-3 py-1 bg-indigo-600 text-white rounded text-sm">Return All</button>
                 </div>
                 <div className="space-y-2">
                   {players.filter(p=>p.status==='passed').map(p => (
                     <div key={p.id} className="flex justify-between items-center p-3 border rounded hover:bg-gray-50">
                       <span className="font-bold">{p.name} <span className="text-xs font-normal text-gray-500">({p.strength})</span></span>
                       <button onClick={()=>auctionSpecificPlayer(p)} className="text-xs bg-green-100 text-green-700 px-3 py-1 rounded font-bold">Auction</button>
                     </div>
                   ))}
                 </div>
               </Card>
             </div>
          );

          const AllPlayersView = () => (
             <div className="h-full overflow-y-auto p-4">
               <Card className="p-6">
                 <div className="flex justify-between items-center mb-4">
                   <h2 className="text-xl font-bold">Master List ({players.length})</h2>
                   <div className="text-xs text-gray-500">Scroll for more details</div>
                 </div>
                 <div className="overflow-x-auto">
                     <table className="w-full text-left text-sm min-w-[800px]">
                       <thead className="bg-gray-50 uppercase text-xs text-gray-500">
                          <tr>
                              <th className="p-3">Name</th>
                              <th className="p-3">Gender</th>
                              <th className="p-3">Email</th>
                              <th className="p-3">Status</th>
                              <th className="p-3 text-right">Price</th>
                              <th className="p-3 text-right">Team</th>
                          </tr>
                       </thead>
                       <tbody>
                         {players.map(p => {
                             const teamName = p.soldTo ? teams[p.soldTo]?.name : '-';
                             return (
                                 <tr key={p.id} className="border-b hover:bg-gray-50">
                                   <td className="p-3 font-medium">{p.name} <span className="text-gray-400 text-xs block">{p.strength}</span></td>
                                   <td className="p-3">{p.gender}</td>
                                   <td className="p-3 text-gray-500 text-xs">{p.email}</td>
                                   <td className="p-3">{getStatusBadge(p)}</td>
                                   <td className="p-3 text-right font-mono">{p.soldPrice ? '‚Çπ'+p.soldPrice.toLocaleString() : '-'}</td>
                                   <td className="p-3 text-right font-bold text-indigo-700">{teamName}</td>
                                 </tr>
                             );
                         })}
                       </tbody>
                     </table>
                 </div>
               </Card>
             </div>
          );

          const UploadView = () => (
            <div className="h-full flex items-center justify-center p-4">
              <Card className="p-12 text-center border-dashed border-2 border-indigo-200 bg-indigo-50">
                <Icon name="Upload" size={48} className="mx-auto text-indigo-400 mb-4" />
                <h2 className="text-2xl font-bold text-indigo-900 mb-2">Data Management</h2>
                <div className="space-y-4 mt-6">
                  <label className="block bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded cursor-pointer">
                    Upload CSV <input type="file" accept=".csv" onChange={handleFileUpload} className="hidden" />
                  </label>
                  <button onClick={handleExport} className="block w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded">
                    Download CSV
                  </button>
                </div>
              </Card>
            </div>
          );

          return (
            <div className="h-screen flex flex-col bg-gray-100 font-sans text-gray-800">
              <nav className="flex-none bg-indigo-900 text-white shadow-lg z-50">
                <div className="container mx-auto px-4 h-14 flex items-center justify-between">
                  <div className="flex items-center gap-2 font-black text-lg tracking-tight">
                    <span className="text-yellow-400">üèè</span> AUCTION
                  </div>
                  <div className="flex items-center gap-2">
                    {['auction', 'teams', 'unsold', 'allPlayers', 'upload'].map(v => (
                      <button key={v} onClick={() => setView(v)} className={`px-3 py-1 rounded text-xs font-bold uppercase transition-colors ${view === v ? 'bg-white text-indigo-900' : 'text-indigo-200 hover:text-white'}`}>
                        {v === 'allPlayers' ? 'All' : v}
                      </button>
                    ))}
                    <button onClick={handleResetData} className="ml-2 text-indigo-300 hover:text-red-400"><Icon name="Trash2" size={18} /></button>
                  </div>
                </div>
              </nav>

              <main className="flex-1 overflow-hidden relative">
                {view === 'auction' && <AuctionView />}
                {view === 'teams' && <TeamsView />}
                {view === 'unsold' && <UnsoldView />}
                {view === 'allPlayers' && <AllPlayersView />}
                {view === 'upload' && <UploadView />}
              </main>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AuctionApp />);
    </script>
</body>
</html>
